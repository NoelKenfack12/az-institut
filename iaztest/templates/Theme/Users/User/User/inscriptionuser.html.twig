{% extends "Theme/Users/User/layoutuserlogin.html.twig" %}
{% block meta %}
	{{ parent() }}
	<meta name="keywords" content="{{ site }}, Business, Innovation,Administration"/>
	<meta name="author" content="Noel Kenfack"/>
	<meta name="description" content="{{ site }} | Inscription | Cameroun | {{ metier }}" />
{% endblock %}

{% block title %}
{{ parent() }} | Connexion
{% endblock %}

{% block stylesheets %}

<meta name="google-signin-client_id" content="808214570153-stbihc7lmtfm86ia20b31pbak1afvam2.apps.googleusercontent.com">
<script src="https://apis.google.com/js/platform.js?onload=renderButton" async defer></script>

<script>
	//Connexion Using Google.
	function onSuccess(googleUser){
	  var profile = googleUser.getBasicProfile();
	  var id = profile.getId();
	  var email = profile.getEmail();
	  var nom = profile.getFamilyName();
	  var prenom = profile.getGivenName();
	  openModalLoginRS(id,email,nom,prenom,'USG','success','login');
	}
	function onFailure(error){
	  openModalLoginRS('','','','','USG','echec','login');
	}
	
	function renderButton(){
	  gapi.signin2.render('my-signin2', {
		'scope': 'profile email',
		'width': 264,
		'height': 42,
		'longtitle': true,
		'theme': 'dark'
	  });
	}
	
	function loginGlOne(){
		gapi.signin2.render('my-signin2',{
		'scope': 'profile email',
		'width': 260,
		'height': 42,
		'longtitle': true,
		'theme': 'dark',
		'onsuccess': onSuccess,
		'onfailure': onFailure
	  });
	}
	
	function openModalLoginRS(id,email,nom,prenom,type,statut,position)
	  {
		//content-modal-annimation-blog
		$('#modal-animation-afex-premium').modal('show');
		$('.wait-account-verification-affiliate').show();
		$('.content-modal-annimation-afex-premium').hide();
		
		$.post('{{ path('users_user_validation_social_login', {'agent': agent|default('ordi') }) }}',{'id': id,'email': email,'nom': nom,'prenom': prenom,'type': type,'statut': statut,'position': position}, function(data){
			$('.wait-account-verification-affiliate').hide();
			$('.content-modal-annimation-afex-premium').show();
			
			if(data == 1){
				$('.content-modal-annimation-afex-premium').html('<div style="display: block; text-align: center;">Connexion effectuée avec succès.</br>Redirection en cours ...</br><img src="{{ asset('template/images/wait-user.gif') }}" alt="image"><div>');
				document.location.href= '{{ path('users_user_acces_plateforme') }}';
			}else{
				$('.content-modal-annimation-afex-premium').html(data);
			}
		});
	  }
	  
	  //Connexion Using FaceBook.

	  function statusChangeCallback(response){
		console.log('statusChangeCallback');
		console.log(response);
		if (response.status === 'connected') {
		  testAPI();
		} else {
		  //document.getElementById('status').innerHTML = 'Please log ' +'into this app.';
		}
	  }


	  function checkLoginState() {
		FB.getLoginStatus(function(response) {
		  statusChangeCallback(response);
		});
	  }

	  window.fbAsyncInit = function() {
		FB.init({
		  appId      : '1913794535583232',
		  xfbml      : true,
		  version    : 'v3.1'
		});
		//FB.getLoginStatus(function(response) {
		 // statusChangeCallback(response);
		//});
	  };

	  // Load the SDK asynchronously
	  (function(d, s, id) {
		  var js, fjs = d.getElementsByTagName(s)[0];
		  if (d.getElementById(id)) return;
		  js = d.createElement(s); js.id = id;
		  js.src = 'https://connect.facebook.net/fr_FR/sdk.js#xfbml=1&version=v3.1&appId=1913794535583232&autoLogAppEvents=1';
		  fjs.parentNode.insertBefore(js, fjs);
		}(document, 'script', 'facebook-jssdk'));

	  // Here we run a very simple test of the Graph API after login is
	  // successful.  See statusChangeCallback() for when this call is made.
	  function testAPI() {
		console.log('Welcome!  Fetching your information.... ');
		FB.api('/me?fields=id,name,email', function(response) {
		 // console.log('Successful login for: ' + response.name);
		  //document.getElementById('status').innerHTML =
		 //   'Thanks for logging in, ' + response.name + ' - ' + JSON.stringify(response)+ '!';
		 
		 if (!response || response.error){
			openModalLoginRS('','','','','USF','echec','login');
		  } else {
			openModalLoginRS(response.id,response.email,response.name,'','USF','success','login');
		  }
			  
		});
	  }
</script>
{{ parent() }}
{% endblock %}

{% block userblog_body %}	
	
<section class="section">
	<h3>Créez un nouveau compte {{ site }}.</h3>

	<div style="text-align: center!important;">
	 <fb:login-button scope="public_profile,email,user_friends" onlogin="checkLoginState();" class="fb-login-button" data-max-rows="1" data-size="large" data-button-type="continue_with" data-show-faces="false" data-auto-logout-link="false" data-use-continue-as="false">
	 </fb:login-button>
	</div>
	 
	 <div style="text-align: center!important;">
		<button id="my-signin2" onclick="loginGlOne()" style="border: none; margin: 15px 0px 0px 0px; padding: 0px;"></button>
	 </div>
	
	<div class="animation-container">
		<!-- Step one -->
		<div class="form-step js-form-step" data-step="1">
			<p class="form-instructions"><strong>Pour vous inscrire rapidement sur AZ Corporation, cliquez sur l'un des boutons ci-dessus pour continuer</strong></p>
			
			<p class="form-instructions">
			    <div style="text-align: center; margin: 25px 0px;">
				<div class="or-spacer">
				  <div class="mask"></div>
				  <span><i>ou</i></span>
				</div>
				</div>
			</p>

				{{ form_start(form, {'attr': {'action': path('users_user_inscription_user') }}) }}
				<div style="color: red;">{{ form_errors(form) }}</div>
				<div class="fieldgroup">
					{{ form_widget(form.nom) }}
					{{ form_label(form.nom, 'Votre Nom') }}
					<div style="color: red;">{{ form_errors(form.nom) }}</div>
				</div>

				<div class="fieldgroup">
					{{ form_widget(form.prenom) }}
					{{ form_label(form.prenom, 'Votre prenom') }}
					<div style="color: red;">{{ form_errors(form.prenom) }}</div>
				</div>
				
				<div class="fieldgroup">
					{{ form_widget(form.username, {'attr': {'autocomplete': 'email'}}) }}
					{{ form_label(form.username, 'Téléphone ou Email') }}
					<div style="color: red;">{{ form_errors(form.username) }}</div>
				</div>
				
				<div class="fieldgroup">
					{{ form_widget(form.password) }}
					{{ form_label(form.password, 'Mot de passe') }}
					<div style="color: red;">{{ form_errors(form.password) }}</div>
				</div>

				<div class="fieldgroup" style="text-align: center;">
					<button type="submit" class="btn">Continuer</button>
				</div>

				{{ form_end(form) }}
				
				

			<div class="signup-content">
				<h3>Vous avez déjà un compte {{ site }} ?</h3>
			    <p>Vous devez juste vous connecter pour contrôler les actions que vous avez effectuées précedemment !</p>
				<div>
					<a href="{{ path('users_user_connexion_user') }}">Se connecter <span class="fa fa-angle-right"></span></a>
				</div>
			</div>
			
		</div>

	</div>
</section>

	
{% endblock %}

{% block javascripttemplate %}
{% endblock %}